{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Caja Izquierda - Más Ancha -->
        <div class="col-lg-8 mb-4">
            <div class="d-flex align-items-start" style="border: 2px solid white; padding: 20px; border-radius: 8px;">
                <!-- Caja Blanca con Logo del Torneo -->
                <div class="bg-white p-3 rounded d-flex justify-content-center align-items-center" 
                    style="width: 120px; height: 120px;">
                    <!-- Logo del Torneo -->
                    <img src="{% static 'images/Logo_Liga.png' %}" alt="Logo del Torneo" class="img-fluid" style="max-width: 100px;">
                </div>

                <!-- Contenedor para el texto -->
                <div class="bg-black text-white p-3 ms-3 rounded" style="flex: 1;">
                    <h5 class="mb-2" style="font-weight: bold;">{{ torneo.nombre_torneo }}</h5>
                    <p class="mb-0" style="font-size: 0.9em;">
                        <strong>Tipo:</strong> {{ torneo.id_tipo_torneo.nombre_tipo_torneo }}
                    </p>

                    <!-- Botón para la Última Temporada -->
                    <div class="dropdown mt-3">
                        <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton" aria-expanded="false" style="font-weight: bold; font-size: 0.85em;">
                            Cargando...
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown-menu-temporadas">
                            <!-- Opciones de temporadas se llenarán con JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Caja Derecha - Menos Ancha -->
        <div class="col-lg-4 mb-4">
            <div class="card" style="background-color: black; border: 2px solid white; height: 300px; border-radius: 8px">
                <!-- Contenido vacío -->
            </div>
        </div>
    </div>
</div>

<!-- Incluye Bootstrap JS y dependencias si es necesario -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var torneoId = "{{ torneo.id_torneo }}";
        var url = "{% url 'obtener_temporadas' torneo.id_torneo %}";

        fetch(url)
            .then(response => response.json())
            .then(data => {
                var dropdownButton = document.getElementById('dropdownMenuButton');
                var dropdownMenu = document.getElementById('dropdown-menu-temporadas');

                // Limpiar el dropdown
                dropdownMenu.innerHTML = '';

                if (data.temporadas.length > 0) {
                    // Mostrar la última temporada en el botón
                    var ultima = data.temporadas[0];  // La primera en la lista después de ordenar por id_temporada
                    dropdownButton.textContent = ultima.nombre_temporada;

                    // Añadir opciones al dropdown
                    data.temporadas.forEach(function(temporada) {
                        var item = document.createElement('li');
                        item.classList.add('dropdown-item');
                        item.textContent = temporada.nombre_temporada + ' (' + new Date(temporada.fecha_inicio).getFullYear() + ')';
                        dropdownMenu.appendChild(item);
                    });
                } else {
                    dropdownButton.textContent = 'No hay temporadas disponibles';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>
{% endblock %}
